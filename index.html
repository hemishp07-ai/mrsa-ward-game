<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infection Control: MRSA Management</title>
    <style>
        :root {
            --primary: #0056b3; /* Medical Blue */
            --secondary: #00875a; /* Success Green */
            --danger: #d32f2f;
            --warning: #f57c00;
            --light: #f8f9fa;
            --dark: #212529;
            --border: #dee2e6;
            --sidebar-width: 280px;
            --font-main: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: var(--font-main);
            background: #f4f6f8;
            color: var(--dark);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- Sidebar Navigation --- */
        .sidebar {
            width: var(--sidebar-width);
            background: #ffffff;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.02);
        }

        .brand {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand-icon {
            width: 32px; height: 32px;
            background: var(--primary);
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold;
        }

        .nav-menu { list-style: none; }
        .nav-item { margin-bottom: 8px; }
        
        .nav-btn {
            width: 100%;
            padding: 12px 15px;
            border: none;
            background: transparent;
            color: #555;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        
        .nav-btn:hover { background: #e3f2fd; color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; }

        .progress-card {
            margin-top: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        .progress-title { font-size: 0.8rem; font-weight: 700; color: #666; margin-bottom: 8px; }
        .progress-bar-bg { height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--secondary); width: 0%; transition: width 0.3s; }

        /* --- Main Content Area --- */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }

        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Guidelines / Learning View --- */
        .header-large { margin-bottom: 20px; }
        .header-large h1 { font-size: 2rem; color: #2c3e50; margin-bottom: 10px; }
        .header-large p { color: #6c757d; max-width: 800px; line-height: 1.6; }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .info-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            border-top: 4px solid var(--primary);
        }

        .info-card h3 { color: var(--primary); margin-bottom: 15px; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .info-card p, .info-card li { font-size: 0.95rem; line-height: 1.6; color: #444; margin-bottom: 10px; }
        .info-card ul { padding-left: 20px; }

        .highlight-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
            margin: 15px 0;
            font-size: 0.9rem;
        }

        /* --- Simulation View (EMR Style) --- */
        .emr-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            height: calc(100vh - 100px);
        }

        .emr-left {
            display: flex; flex-direction: column; gap: 20px;
        }
        
        .emr-right {
            display: flex; flex-direction: column; gap: 20px;
        }

        .emr-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            overflow: hidden;
            display: flex; flex-direction: column;
        }
        
        .emr-header {
            background: #f1f3f5;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            display: flex; justify-content: space-between; align-items: center;
        }

        .emr-body { padding: 20px; overflow-y: auto; flex: 1; }

        /* Narrative Text */
        .narrative-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #212529;
            margin-bottom: 25px;
        }

        /* Vitals Dashboard */
        .vitals-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        .vital-item {
            background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center;
        }
        .vital-label { font-size: 0.75rem; text-transform: uppercase; color: #6c757d; font-weight: 700; }
        .vital-value { font-size: 1.4rem; font-weight: 700; color: var(--primary); }
        .vital-value.critical { color: var(--danger); }

        /* Choices */
        .choice-btn {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            background: white;
            border: 1px solid var(--border);
            border-left: 4px solid #ced4da;
            border-radius: 6px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .choice-btn:hover {
            border-left-color: var(--primary);
            background: #f8f9fa;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .choice-title { font-weight: 600; color: #343a40; display: block; margin-bottom: 4px; }
        .choice-desc { font-size: 0.85rem; color: #6c757d; }

        /* Feedback Area */
        .feedback-panel {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.95rem;
            line-height: 1.5;
            display: none;
        }
        .feedback-panel.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-panel.incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .next-btn {
            background: var(--primary); color: white; border: none; padding: 12px 24px;
            border-radius: 6px; font-weight: 600; cursor: pointer; float: right; margin-top: 15px;
            display: none;
        }
        .next-btn:hover { background: #004494; }

        /* Risk Meters */
        .meter-label { font-size: 0.8rem; font-weight: 600; color: #495057; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .meter-track { height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden; margin-bottom: 15px; }
        .meter-fill { height: 100%; width: 50%; transition: width 0.5s; }
        .fill-risk { background: linear-gradient(90deg, #4caf50, #f44336); } /* Green to Red */
        .fill-health { background: linear-gradient(90deg, #f44336, #4caf50); } /* Red to Green */

        .status-badge {
            display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
        }
        .badge-safe { background: #d4edda; color: #155724; }
        .badge-danger { background: #f8d7da; color: #721c24; }

    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="brand">
            <div class="brand-icon">M</div>
            <span>MedTrain: MRSA</span>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <button class="nav-btn active" onclick="switchView('learn')">
                    <span>üìò</span> Knowledge Base
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-btn" onclick="switchView('sim')">
                    <span>üè•</span> Clinical Simulation
                </button>
            </li>
        </ul>

        <div class="progress-card">
            <div class="progress-title">Training Progress</div>
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="total-progress"></div>
            </div>
            <div style="font-size: 0.75rem; color: #888; margin-top: 5px;" id="progress-text">0% Complete</div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        
        <!-- LEARNING MODULE -->
        <section id="view-learn" class="view-section active">
            <div class="header-large">
                <h1>MRSA Infection Control</h1>
                <p>Methicillin-Resistant <i>Staphylococcus aureus</i> is a multidrug-resistant organism (MDRO) requiring strict adherence to infection control protocols. Review the guidelines below before starting the simulation.</p>
            </div>

            <div class="info-grid">
                <!-- CARD 1: Transmission -->
                <div class="info-card">
                    <h3>ü¶† Transmission Dynamics</h3>
                    <p>MRSA is primarily transmitted via:</p>
                    <ul>
                        <li><strong>Direct Contact:</strong> Contaminated hands of healthcare workers.</li>
                        <li><strong>Fomites:</strong> High-touch surfaces (bed rails, door handles, stethoscopes).</li>
                        <li><strong>Droplets:</strong> In rare cases of MRSA pneumonia.</li>
                    </ul>
                    <div class="highlight-box">
                        <strong>The 5 Moments of Hand Hygiene:</strong>
                        <ol>
                            <li>Before touching a patient</li>
                            <li>Before clean/aseptic procedures</li>
                            <li>After body fluid exposure risk</li>
                            <li>After touching a patient</li>
                            <li>After touching patient surroundings</li>
                        </ol>
                    </div>
                </div>

                <!-- CARD 2: Screening & Isolation -->
                <div class="info-card">
                    <h3>üõ°Ô∏è Screening & Isolation</h3>
                    <p><strong>Admission Screening:</strong> Swabs (Nasal, Groin/Perineum) required for:</p>
                    <ul>
                        <li>Patients from other healthcare facilities/nursing homes.</li>
                        <li>History of MRSA colonization.</li>
                        <li>Patients with chronic wounds or indwelling devices.</li>
                    </ul>
                    <p><strong>Contact Precautions:</strong></p>
                    <ul>
                        <li><strong>Placement:</strong> Single room (preferred) or Cohort (MRSA with MRSA).</li>
                        <li><strong>PPE:</strong> Gloves + Gown on entry. Remove before exit.</li>
                        <li><strong>Signage:</strong> Clear door signage required.</li>
                    </ul>
                </div>

                <!-- CARD 3: Environmental Hygiene -->
                <div class="info-card">
                    <h3>üßπ Environmental Hygiene</h3>
                    <p>MRSA can survive on surfaces for days to months.</p>
                    <ul>
                        <li><strong>Daily Clean:</strong> Focus on high-touch surfaces using hospital-grade disinfectant.</li>
                        <li><strong>Shared Equipment:</strong> BP cuffs, thermometers must be cleaned <i>between every patient</i>.</li>
                        <li><strong>Terminal Clean:</strong> Deep clean upon discharge including curtains change.</li>
                    </ul>
                    <div class="highlight-box">
                        <strong>Alert:</strong> Bed curtains are a frequent, overlooked reservoir for MRSA.
                    </div>
                </div>
            </div>
            
            <button class="choice-btn" style="margin-top: 30px; text-align: center; font-weight: bold; background: var(--primary); color: white; border: none;" onclick="switchView('sim')">
                Start Clinical Simulation
            </button>
        </section>

        <!-- SIMULATION MODULE -->
        <section id="view-sim" class="view-section">
            <div class="emr-container">
                
                <!-- LEFT: Narrative & Decisions -->
                <div class="emr-left">
                    <div class="emr-card" style="flex:1;">
                        <div class="emr-header">
                            <span>CASE NARRATIVE</span>
                            <span id="turn-indicator">Phase 1 of 5</span>
                        </div>
                        <div class="emr-body">
                            <div id="narrative-text" class="narrative-text">
                                Loading scenario...
                            </div>
                            
                            <div id="choices-area">
                                <!-- Choices injected here -->
                            </div>

                            <div id="feedback-area" class="feedback-panel"></div>
                            <button id="sim-next-btn" class="next-btn" onclick="sim.nextTurn()">Continue</button>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Vitals & Status -->
                <div class="emr-right">
                    <div class="emr-card">
                        <div class="emr-header">PATIENT STATUS</div>
                        <div class="emr-body">
                            <div class="vitals-grid">
                                <div class="vital-item">
                                    <span class="vital-label">TEMP</span>
                                    <span class="vital-value critical" id="val-temp">39.2¬∞C</span>
                                </div>
                                <div class="vital-item">
                                    <span class="vital-label">BP</span>
                                    <span class="vital-value" id="val-bp">100/65</span>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <div class="meter-label">
                                    <span>Patient Health</span>
                                    <span id="hp-text">80%</span>
                                </div>
                                <div class="meter-track">
                                    <div class="meter-fill fill-health" id="hp-bar" style="width: 80%;"></div>
                                </div>

                                <div class="meter-label">
                                    <span>Ward Contamination Risk</span>
                                    <span id="risk-text">10%</span>
                                </div>
                                <div class="meter-track">
                                    <div class="meter-fill fill-risk" id="risk-bar" style="width: 10%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="emr-card" style="flex: 1;">
                        <div class="emr-header">INFECTION CONTROL LOG</div>
                        <div class="emr-body" id="audit-log" style="font-size: 0.85rem; color: #666; font-family: monospace;">
                            <div>> Session Started</div>
                            <div>> Patient Admitted</div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </main>

<script>
    // --- Navigation Logic ---
    function switchView(viewId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(`view-${viewId}`).classList.add('active');
        
        // Update button state
        const btns = document.querySelectorAll('.nav-btn');
        if(viewId === 'learn') btns[0].classList.add('active');
        if(viewId === 'sim') btns[1].classList.add('active');
    }

    // --- Simulation Logic ---
    class Simulation {
        constructor() {
            this.hp = 80;
            this.risk = 10;
            this.turn = 0;
            
            // Scenario Data with Educational Depth
            this.phases = [
                {
                    title: "Admission Assessment",
                    text: "Patient J.D. (45M) is admitted from a nursing home with a purulent leg wound. He is febrile (39.2¬∞C). The emergency department is overcrowded. You must decide on placement and initial orders.",
                    choices: [
                        {
                            title: "Isolate & Screen",
                            desc: "Place in single room, Contact Precautions (Gown/Glove), and swab for MRSA PCR.",
                            correct: true,
                            feedback: "Correct. Nursing home residents are high-risk for MRSA colonization. Isolation prevents immediate transmission. PCR allows rapid detection.",
                            fx: { hp: 0, risk: -5 }
                        },
                        {
                            title: "Standard Admission",
                            desc: "Place in 4-bed bay, Standard Precautions, start IV Antibiotics.",
                            correct: false,
                            feedback: "Critical Error. Placing a high-risk patient in a multi-bed bay exposes other patients. Standard precautions are insufficient for draining wounds.",
                            fx: { hp: 0, risk: 25 }
                        }
                    ]
                },
                {
                    title: "Antibiotic Selection",
                    text: "The wound is drained. The lab calls: Gram-positive cocci in clusters. Patient is hypotensive. You need to choose empiric therapy.",
                    choices: [
                        {
                            title: "IV Vancomycin",
                            desc: "Start Vancomycin dosing based on weight and renal function.",
                            correct: true,
                            feedback: "Correct. Vancomycin is the first-line therapy for suspected MRSA in hospitalized patients. It covers resistant strains that Beta-lactams miss.",
                            fx: { hp: 10, risk: 0 }
                        },
                        {
                            title: "IV Flucloxacillin",
                            desc: "Start standard anti-staphylococcal penicillin.",
                            correct: false,
                            feedback: "Incorrect. MRSA possesses the mecA gene, encoding PBP2a, which renders Flucloxacillin ineffective. Delay in appropriate therapy increases mortality.",
                            fx: { hp: -20, risk: 0 }
                        }
                    ]
                },
                {
                    title: "Daily Care & Hygiene",
                    text: "Day 2. The patient needs vitals and wound care. The nurse is busy and enters the room to silence an alarm.",
                    choices: [
                        {
                            title: "Don PPE for Alarm",
                            desc: "Put on Gown and Gloves before entering, even just for the alarm.",
                            correct: true,
                            feedback: "Correct. 'Patient Surroundings' are part of the 5 Moments. MRSA contaminates bed rails and pumps. Touching them without PPE spreads bacteria to the corridor.",
                            fx: { hp: 0, risk: -5 }
                        },
                        {
                            title: "Quick Entry (Hand Gel)",
                            desc: "Use hand gel, silence alarm, use gel on exit.",
                            correct: false,
                            feedback: "Incorrect. While hand hygiene is good, Contact Precautions require Gown/Gloves for entering the room to prevent clothing contamination.",
                            fx: { hp: 0, risk: 15 }
                        }
                    ]
                },
                {
                    title: "Shared Equipment",
                    text: "A nursing assistant brings the vitals machine from the room next door. It was used on a non-MRSA patient.",
                    choices: [
                        {
                            title: "Clean Before Use",
                            desc: "Wipe down the entire machine with disinfectant wipes before bringing it in.",
                            correct: true,
                            feedback: "Correct. But ideally, MRSA patients should have dedicated equipment. If sharing is unavoidable, cleaning *between* patients is non-negotiable.",
                            fx: { hp: 0, risk: -5 }
                        },
                        {
                            title: "Clean After Use",
                            desc: "Use the machine, then clean it thoroughly before taking it out.",
                            correct: false,
                            feedback: "Risky. While cleaning on exit protects the *next* patient, bringing the machine in without cleaning assumes the previous patient wasn't an asymptomatic carrier.",
                            fx: { hp: 0, risk: 5 }
                        }
                    ]
                },
                {
                    title: "Discharge Planning",
                    text: "Patient is improving. Preparing for discharge. The room needs to be turned over for a surgical patient.",
                    choices: [
                        {
                            title: "Terminal Clean",
                            desc: "Request environmental services for 'Terminal Clean' including curtain change.",
                            correct: true,
                            feedback: "Correct. MRSA persists in dust and fabric. Curtains are a major reservoir and must be changed on discharge of an isolation patient.",
                            fx: { hp: 5, risk: -20 }
                        },
                        {
                            title: "Standard Clean",
                            desc: "Wipe down bed and table, change sheets.",
                            correct: false,
                            feedback: "Insufficient. Standard cleaning misses floors, walls, and curtains where MRSA may persist, putting the next surgical patient at high risk of infection.",
                            fx: { hp: 0, risk: 30 }
                        }
                    ]
                }
            ];

            this.render();
        }

        render() {
            if (this.turn >= this.phases.length) {
                this.endGame();
                return;
            }

            const phase = this.phases[this.turn];
            
            // Text
            document.getElementById('turn-indicator').innerText = `PHASE ${this.turn + 1} OF ${this.phases.length}`;
            document.getElementById('narrative-text').innerText = phase.text;

            // Choices
            const area = document.getElementById('choices-area');
            area.innerHTML = '';
            
            phase.choices.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.innerHTML = `<span class="choice-title">${choice.title}</span><span class="choice-desc">${choice.desc}</span>`;
                btn.onclick = () => this.makeChoice(index);
                area.appendChild(btn);
            });

            // Hide Feedback
            document.getElementById('feedback-area').style.display = 'none';
            document.getElementById('sim-next-btn').style.display = 'none';
        }

        makeChoice(index) {
            const phase = this.phases[this.turn];
            const choice = phase.choices[index];
            
            // Apply Effects
            this.hp = Math.min(100, Math.max(0, this.hp + choice.fx.hp));
            this.risk = Math.min(100, Math.max(0, this.risk + choice.fx.risk));
            
            // Update UI Bars
            document.getElementById('hp-bar').style.width = this.hp + '%';
            document.getElementById('hp-text').innerText = this.hp + '%';
            document.getElementById('risk-bar').style.width = this.risk + '%';
            document.getElementById('risk-text').innerText = this.risk + '%';
            
            // Update Log
            const log = document.getElementById('audit-log');
            const entry = document.createElement('div');
            entry.innerText = `> ${choice.title}: ${choice.correct ? 'Protocol Followed' : 'Protocol Breach'}`;
            entry.style.color = choice.correct ? 'green' : 'red';
            log.appendChild(entry);

            // Show Feedback
            const fb = document.getElementById('feedback-area');
            fb.style.display = 'block';
            fb.className = `feedback-panel ${choice.correct ? 'correct' : 'incorrect'}`;
            fb.innerHTML = `<strong>${choice.correct ? 'Protocol Adhered' : 'Protocol Deviation'}</strong><br>${choice.feedback}`;
            
            // Disable buttons
            document.querySelectorAll('.choice-btn').forEach(b => b.disabled = true);
            document.getElementById('sim-next-btn').style.display = 'block';
            
            // Progress Bar
            const prog = ((this.turn + 1) / this.phases.length) * 100;
            document.getElementById('total-progress').style.width = prog + '%';
            document.getElementById('progress-text').innerText = Math.round(prog) + '% Complete';
        }

        nextTurn() {
            this.turn++;
            this.render();
        }

        endGame() {
            document.getElementById('narrative-text').innerHTML = `
                <h3 style="color:${this.risk < 20 ? 'green' : 'red'}">Simulation Complete</h3>
                <p>Final Patient Health: ${this.hp}%</p>
                <p>Final Contamination Risk: ${this.risk}%</p>
                <p>${this.risk < 20 ? 'Excellent work. You maintained strict infection control standards.' : 'Warning: High risk of cross-contamination detected. Please review the Knowledge Base.'}</p>
            `;
            document.getElementById('choices-area').innerHTML = '<button class="choice-btn" onclick="location.reload()">Restart Simulation</button>';
            document.getElementById('feedback-area').style.display = 'none';
            document.getElementById('sim-next-btn').style.display = 'none';
        }
    }

    const sim = new Simulation();
</script>

</body>
</html>
